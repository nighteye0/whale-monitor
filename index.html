<!DOCTYPE html>
<html>
<head>
<title>Whale Monitor - Live Charts</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
body{background:#1a1a1a;color:#fff;font-family:Arial;padding:20px}
.container{max-width:1400px;margin:0 auto}
h1{margin:0 0 10px}
p{margin:0 0 20px;color:#999}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px}
.chart-box{background:#2a2a2a;padding:20px;border-radius:8px;border-left:4px solid #3b82f6}
.stats{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:15px;margin-bottom:30px}
.stat{background:#2a2a2a;padding:20px;border-radius:8px}
.num{font-size:32px;font-weight:bold;margin-top:10px}
table{width:100%;border-collapse:collapse;background:#2a2a2a}
th{background:#1a1a1a;padding:12px;text-align:left;border-bottom:2px solid #3b82f6}
td{padding:10px 12px;border-bottom:1px solid #333}
.buy{color:#10b981;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#f59e0b;font-weight:bold}
.msg{padding:15px;margin-bottom:20px;border-radius:8px}
.ok{background:rgba(16,185,129,0.1);color:#10b981}
.err{background:rgba(239,68,68,0.1);color:#ef4444}
select{background:#1a1a1a;color:#fff;border:1px solid #444;padding:8px;border-radius:4px;margin-bottom:15px}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ‹ Whale Monitor - Live Charts</h1>
<p>Real-time signals + Live Price Charts</p>
<div id="msg"></div>

<div class="stats">
<div class="stat"><div>Total Signals</div><div class="num" id="total">--</div></div>
<div class="stat"><div>ğŸš€ BUY</div><div class="num buy" id="buys">--</div></div>
<div class="stat"><div>ğŸ“‰ SELL</div><div class="num sell" id="sells">--</div></div>
<div class="stat"><div>â¡ï¸ HOLD</div><div class="num hold" id="holds">--</div></div>
</div>

<div class="grid">
<div class="chart-box">
<h3>ğŸ“ˆ Bitcoin (1 Hour)</h3>
<select id="btc-interval" onchange="updateBTCChart()">
<option value="1m">1 Minute</option>
<option value="5m">5 Minutes</option>
<option value="15m" selected>15 Minutes</option>
<option value="1h">1 Hour</option>
<option value="4h">4 Hours</option>
<option value="1d">1 Day</option>
</select>
<canvas id="btcChart"></canvas>
</div>

<div class="chart-box">
<h3>ğŸ“ˆ Ethereum (1 Hour)</h3>
<select id="eth-interval" onchange="updateETHChart()">
<option value="1m">1 Minute</option>
<option value="5m">5 Minutes</option>
<option value="15m" selected>15 Minutes</option>
<option value="1h">1 Hour</option>
<option value="4h">4 Hours</option>
<option value="1d">1 Day</option>
</select>
<canvas id="ethChart"></canvas>
</div>

<div class="chart-box">
<h3>ğŸ“ˆ BNB (1 Hour)</h3>
<select id="bnb-interval" onchange="updateBNBChart()">
<option value="1m">1 Minute</option>
<option value="5m">5 Minutes</option>
<option value="15m" selected>15 Minutes</option>
<option value="1h">1 Hour</option>
<option value="4h">4 Hours</option>
<option value="1d">1 Day</option>
</select>
<canvas id="bnbChart"></canvas>
</div>

<div class="chart-box">
<h3>ğŸ“ˆ XRP (1 Hour)</h3>
<select id="xrp-interval" onchange="updateXRPChart()">
<option value="1m">1 Minute</option>
<option value="5m">5 Minutes</option>
<option value="15m" selected>15 Minutes</option>
<option value="1h">1 Hour</option>
<option value="4h">4 Hours</option>
<option value="1d">1 Day</option>
</select>
<canvas id="xrpChart"></canvas>
</div>
</div>

<h2>ğŸ“Š Recent Signals</h2>
<table>
<thead><tr><th>Symbol</th><th>Price</th><th>Action</th><th>Conf</th><th>Signal</th><th>Time</th></tr></thead>
<tbody id="tb"><tr><td colspan="6">Loading...</td></tr></tbody>
</table>
</div>

<script>
const API='https://jaelynn-uncrystalled-memorisingly.ngrok-free.dev/api';
let charts = {};

async function loadSignals(){
try{
const r=await fetch(API+'/whale-signals?limit=20');
const d=await r.json();
const b=d.signals.filter(x=>x.action==='BUY').length;
const s=d.signals.filter(x=>x.action==='SELL').length;
const h=d.signals.filter(x=>x.action==='HOLD').length;
document.getElementById('total').textContent=d.total;
document.getElementById('buys').textContent=b;
document.getElementById('sells').textContent=s;
document.getElementById('holds').textContent=h;
document.getElementById('msg').innerHTML='<div class="msg ok">âœ… Connected! '+d.total+' signals</div>';
let html='';
d.signals.slice().reverse().forEach(x=>{
const c=x.action==='BUY'?'buy':x.action==='SELL'?'sell':'hold';
const e=x.action==='BUY'?'ğŸš€':x.action==='SELL'?'ğŸ“‰':'â¡ï¸';
html+='<tr><td><b>'+x.symbol+'</b></td><td>$'+x.price.toFixed(2)+'</td><td class="'+c+'">'+e+' '+x.action+'</td><td>'+(x.confidence*100).toFixed(0)+'%</td><td>'+(x.whale_signal||'N/A')+'</td><td>'+new Date(x.timestamp).toLocaleTimeString()+'</td></tr>';
});
document.getElementById('tb').innerHTML=html;
}catch(e){
document.getElementById('msg').innerHTML='<div class="msg err">âŒ Bot offline</div>';
}}

async function loadChart(symbol, canvasId, chartKey){
try{
const interval = document.getElementById(chartKey+'-interval')?.value || '15m';
const r=await fetch(API+'/chart/'+symbol+'?interval='+interval+'&limit=50');
const data=await r.json();

const ctx=document.getElementById(canvasId).getContext('2d');

if(charts[chartKey]) charts[chartKey].destroy();

charts[chartKey]=new Chart(ctx,{
type:'line',
data:{
labels:data.map(d=>new Date(d.timestamp).toLocaleTimeString()),
datasets:[{
label:symbol+' Price',
data:data.map(d=>d.close),
borderColor:'#3b82f6',
backgroundColor:'rgba(59,130,246,0.1)',
tension:0.1,
fill:true,
pointRadius:2,
pointBackgroundColor:'#10b981'
}]
},
options:{
responsive:true,
plugins:{legend:{display:true,labels:{color:'#fff'}}},
scales:{
y:{ticks:{color:'#999'},grid:{color:'#333'}},
x:{ticks:{color:'#999'},grid:{color:'#333'}}
}
}
});
}catch(e){
console.log('Chart error:',e);
}}

function updateBTCChart(){loadChart('BTCUSDT','btcChart','btc')}
function updateETHChart(){loadChart('ETHUSDT','ethChart','eth')}
function updateBNBChart(){loadChart('BNBUSDT','bnbChart','bnb')}
function updateXRPChart(){loadChart('XRPUSDT','xrpChart','xrp')}

loadSignals();
loadChart('BTCUSDT','btcChart','btc');
loadChart('ETHUSDT','ethChart','eth');
loadChart('BNBUSDT','bnbChart','bnb');
loadChart('XRPUSDT','xrpChart','xrp');

setInterval(loadSignals,5000);
setInterval(()=>{
updateBTCChart();
updateETHChart();
updateBNBChart();
updateXRPChart();
},30000);
</script>
</body>
</html>
