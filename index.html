<!DOCTYPE html>
<html>
<head>
<title>Whale Monitor - Live Charts</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
body{background:#1a1a1a;color:#fff;font-family:Arial;padding:20px}
.container{max-width:1400px;margin:0 auto}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px}
.chart-container{background:#2a2a2a;padding:20px;border-radius:8px;position:relative;height:400px}
.stats{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:15px;margin-bottom:30px}
.stat{background:#2a2a2a;padding:20px;border-radius:8px}
.num{font-size:32px;font-weight:bold;color:#10b981}
table{width:100%;border-collapse:collapse;background:#2a2a2a}
th,td{padding:12px;text-align:left;border-bottom:1px solid #333}
.msg{padding:15px;margin-bottom:20px;border-radius:8px;background:rgba(16,185,129,0.1);color:#10b981}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ‹ Whale Monitor - Live Charts & Signals</h1>
<div id="msg">âœ… Connected! Loading charts...</div>

<div class="stats">
<div class="stat"><div>Total Signals</div><div class="num" id="total">0</div></div>
<div class="stat"><div>ğŸš€ BUY</div><div class="num" id="buys">0</div></div>
<div class="stat"><div>ğŸ“‰ SELL</div><div class="num" id="sells">0</div></div>
<div class="stat"><div>â¡ï¸ HOLD</div><div class="num" id="holds">0</div></div>
</div>

<div class="grid">
<div class="chart-container">
<h3>ğŸ“ˆ Bitcoin (BTCUSDT)</h3>
<canvas id="btcChart"></canvas>
</div>
<div class="chart-container">
<h3>ğŸ“ˆ Ethereum (ETHUSDT)</h3>
<canvas id="ethChart"></canvas>
</div>
<div class="chart-container">
<h3>ğŸ“ˆ BNB (BNBUSDT)</h3>
<canvas id="bnbChart"></canvas>
</div>
<div class="chart-container">
<h3>ğŸ“ˆ XRP (XRPUSDT)</h3>
<canvas id="xrpChart"></canvas>
</div>
</div>

<h2>ğŸ“Š Live Signals</h2>
<table>
<thead><tr><th>Symbol</th><th>Price</th><th>Action</th><th>Confidence</th><th>Signal</th><th>Time</th></tr></thead>
<tbody id="tb"></tbody>
</table>
</div>

<script>
const API='https://jaelynn-uncrystalled-memorisingly.ngrok-free.dev/api';
let chartInstances={};

async function loadSignals(){
try{
const res=await fetch(API+'/whale-signals?limit=20&t='+Date.now(),{headers:{'ngrok-skip-browser-warning':'69420'}});
const d=await res.json();
document.getElementById('total').innerText=d.total;
document.getElementById('buys').innerText=d.signals.filter(s=>s.action==='BUY').length;
document.getElementById('sells').innerText=d.signals.filter(s=>s.action==='SELL').length;
document.getElementById('holds').innerText=d.signals.filter(s=>s.action==='HOLD').length;
let html='';
d.signals.slice().reverse().slice(0,20).forEach(s=>{
const e=s.action==='BUY'?'ğŸš€':s.action==='SELL'?'ğŸ“‰':'â¡ï¸';
html+='<tr><td>'+s.symbol+'</td><td>$'+s.price.toFixed(2)+'</td><td><b>'+e+' '+s.action+'</b></td><td>'+(s.confidence*100).toFixed(0)+'%</td><td>'+s.whale_signal+'</td><td>'+new Date(s.timestamp).toLocaleTimeString()+'</td></tr>';
});
document.getElementById('tb').innerHTML=html;
}catch(e){console.error(e);}}

async function loadChart(symbol,canvasId){
try{
const res=await fetch(API+'/chart/'+symbol+'?interval=15m&limit=50&t='+Date.now(),{headers:{'ngrok-skip-browser-warning':'69420'}});
const data=await res.json();
const ctx=document.getElementById(canvasId).getContext('2d');
if(chartInstances[canvasId])chartInstances[canvasId].destroy();
chartInstances[canvasId]=new Chart(ctx,{
type:'line',
data:{
labels:data.map(d=>new Date(d.timestamp).toLocaleTimeString()),
datasets:[{
label:symbol,
data:data.map(d=>d.close),
borderColor:'#3b82f6',
backgroundColor:'rgba(59,130,246,0.1)',
tension:0.4,
fill:true,
pointRadius:0,
pointHoverRadius:5
}]
},
options:{
responsive:true,
maintainAspectRatio:false,
interaction:{mode:'index',intersect:false},
plugins:{
legend:{display:true,labels:{color:'#999'}},
title:{display:false}
},
scales:{
y:{beginAtZero:false,ticks:{color:'#999'},grid:{color:'#333'}},
x:{ticks:{color:'#999'},grid:{color:'#333'}}
}
});
}catch(e){console.error('Chart error:',e);}}

async function updateAll(){
await loadSignals();
await loadChart('BTCUSDT','btcChart');
await loadChart('ETHUSDT','ethChart');
await loadChart('BNBUSDT','bnbChart');
await loadChart('XRPUSDT','xrpChart');
}

updateAll();
setInterval(updateAll, 10000);
</script>
</body>
</html>
